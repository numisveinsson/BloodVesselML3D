# vascular_data

This repository contains code to generate the data used to train the SimVascular Machine Learning 2D segmentation neural networks.

The code processes data from the Vascular Model Repository (VMR) into files that are easy to read using Python.
In particular, for each case in the VMR, and for each vessel pathline for that case, the code loops over all path points where a user has segmented the vessel lumen and extracts a cross-sectional reslice image of the vessel at that location, along with the segmented lumen contour points.
The code also extracts cross-sectional reslice images from the ground-truth cardiovascular model (represented as an image volume with binary pixel values).

## Running the code

This code relies on the VMR being stored in a particular folder structure.
The original data used can be found in `/home/SHARED/vascular_data` on the Marsden Lab Skalak file server.

All cases should be stored in separate folders under one main folder.
The main folder should have the path indicated by `CASES_PREFIX` in the config file `/config/case.yaml` in this repository.

The locations of the image volume files, ground-truth binary image volume files, path files and group folders should then be indicated in `.txt` files.
An example of this can be found in `/cases` in this repository.

Once these files have been set up, the data can be generated by running

```
python generate_cases.py
```

```
python process_data.py
```

Finally note that a copy of the processed data is stored at `/home/SHARED/ML` on the Marsden Lab Skalak filer server.


#### Numis version

Generating 3D data for Ml requires running three scripts

1. python3 generate_cases.py

This collects the different vascular models we have and the different locations of all files

2. python3 gather_sampling_data.py

This collects data about all positions of sampling to take place and size of sub-volumes

3. python3 extract_3d_data.py

This runs through the locations and actually extracts the sub-volumes and saves them
